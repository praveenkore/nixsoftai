benchmark: STIG
id: "V-230278"
title: "The SSH daemon must limit the number of authentication attempts."
severity: high
original_severity: "CAT II"
os_compatibility:
  - ubuntu: "18.04+"
rationale: "Limiting authentication attempts protects against brute force attacks by locking out attackers after multiple failed attempts."
check:
  type: file
  command: "grep -E '^MaxAuthTries' /etc/ssh/sshd_config /etc/ssh/sshd_config.d/*.conf 2>/dev/null | grep -v '^#' | awk '{print $2}' | awk '{if ($1 <= 4) exit 0; else exit 1}'"
  expected_state: "0"
remediation:
  commands:
    - "mkdir -p /etc/ssh/sshd_config.d/"
    - "cat > /etc/ssh/sshd_config.d/99-hardening.conf << 'EOF'\n# SSH Hardening Configuration\nMaxAuthTries 3\nEOF"
    - "sshd -t || exit 1"
    - "systemctl restart sshd"
  requires_restart: true
  requires_reboot: false
rollback:
  commands:
    - "rm -f /etc/ssh/sshd_config.d/99-hardening.conf"
    - "systemctl restart sshd"
ai_assist: false
approval_required: true
exception_allowed: true
